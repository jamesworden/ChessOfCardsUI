<div class="game-container">
  <div
    class="game"
    *ngIf="playerGameState$ | async as playerGameState"
    cdkDropListGroup
  >
    <div
      class="opponent-hand"
      [ngStyle]="{
        height: cardSize + 'px',
        padding: '0px ' + cardSize / 2 + 'px',
        'margin-top': '-' + cardSize / 2 + 'px'
      }"
    >
      <app-face-down-card
        *ngFor="
          let _ of [].constructor(playerGameState.NumCardsInOpponentsHand)
        "
      ></app-face-down-card>
    </div>

    <div
      class="board"
      [ngStyle]="{
        padding: cardSize / 2 + 'px 0px',
        'flex-direction': playerGameState.IsHost ? 'row' : 'row-reverse'
      }"
    >
      <app-gutter></app-gutter>

      <ng-container
        *ngFor="let lane of playerGameState.Lanes; let laneIndex = index"
      >
        <ng-container
          *ngIf="
            (initialPlaceMultipleCardAttempt$ | async)?.TargetLaneIndex ===
              laneIndex;
            else regularLane
          "
          ><app-place-multiple-cards-lane></app-place-multiple-cards-lane
        ></ng-container>

        <ng-template #regularLane>
          <app-lane
            [lane]="lane"
            [laneIndex]="laneIndex"
            [isHost]="playerGameState.IsHost"
            [redJokerLaneIndex]="playerGameState.RedJokerLaneIndex"
            [blackJokerLaneIndex]="playerGameState.BlackJokerLaneIndex"
            (placeCardAttempted)="onPlaceCardAttempted($event)"
          ></app-lane>
        </ng-template>
      </ng-container>

      <app-gutter
        [cardSize]="cardSize"
        [isHost]="playerGameState.IsHost"
        [numCardsInPlayersDeck]="playerGameState.NumCardsInPlayersDeck"
        [numCardsInOpponentsDeck]="playerGameState.NumCardsInOpponentsDeck"
      ></app-gutter>
    </div>

    <app-player-hand
      [isPlacingMultipleCards]="isPlacingMultipleCards"
      [cards]="playerGameState.Hand.Cards"
      [cardSize]="cardSize"
      [disabled]="!isPlayersTurn"
      (cardDropped)="onPlayerHandCardDrop($event)"
    ></app-player-hand>

    <div
      class="button-toolbar"
      [ngStyle]="{
        padding: '0px ' + cardSize / 2 + 'px'
      }"
    >
      <ng-container *ngIf="isPlacingMultipleCards; else passButton">
        <button
          mat-raised-button
          class="confirm-button"
          color="primary"
          (click)="onConfirmButtonClicked()"
        >
          Confirm
        </button>
        <div class="button-divider"></div>
        <button
          mat-raised-button
          class="cancel-button"
          color="warn"
          (click)="onCancelButtonClicked()"
        >
          Cancel
        </button>
      </ng-container>

      <ng-template #passButton>
        <button
          (click)="onPassButtonClicked()"
          mat-raised-button
          color="primary"
          class="pass-button"
          [disabled]="!isPlayersTurn"
        >
          Pass
        </button>
      </ng-template>
    </div>
  </div>
</div>
