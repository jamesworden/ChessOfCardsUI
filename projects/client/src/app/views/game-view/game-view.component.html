<div class="game-container">
  <div
    class="game"
    *ngIf="playerGameState$ | async as playerGameState"
    cdkDropListGroup
  >
    <div
      class="opponent-hand"
      [ngStyle]="{
        height: cardSize + 'px',
        padding: '0px ' + cardSize / 2 + 'px',
        'margin-top': '-' + cardSize / 2 + 'px'
      }"
    >
      <app-face-down-card
        *ngFor="
          let _ of [].constructor(playerGameState.NumCardsInOpponentsHand)
        "
      ></app-face-down-card>
    </div>

    <div
      class="board"
      [ngStyle]="{
        padding: cardSize / 2 + 'px 0px',
        'flex-direction': playerGameState.IsHost ? 'row-reverse' : 'row'
      }"
    >
      <div
        class="gutter"
        [ngStyle]="{
          width: cardSize / 2 + 'px'
        }"
      >
        <app-deck
          [totalNumCards]="playerGameState.NumCardsInOpponentsDeck"
          [rightSide]="playerGameState.IsHost"
        ></app-deck>

        <div class="deck-divider-middle"></div>

        <app-deck
          [totalNumCards]="playerGameState.NumCardsInPlayersDeck"
          [rightSide]="playerGameState.IsHost"
        ></app-deck>

        <div class="deck-divider-end"></div>
      </div>

      <ng-container
        *ngFor="let lane of playerGameState.Lanes; let laneIndex = index"
      >
        <ng-container
          *ngIf="
            (initialPlaceMultipleCardAttempt$ | async)?.TargetLaneIndex ===
              laneIndex;
            else regularLane
          "
          ><app-place-multiple-cards-lane></app-place-multiple-cards-lane
        ></ng-container>

        <ng-template #regularLane>
          <app-lane
            [lane]="lane"
            [laneIndex]="laneIndex"
            [isHost]="playerGameState.IsHost"
            [redJokerLaneIndex]="playerGameState.RedJokerLaneIndex"
            [blackJokerLaneIndex]="playerGameState.BlackJokerLaneIndex"
            (placeCardAttempted)="onPlaceCardAttempted($event)"
          ></app-lane>
        </ng-template>
      </ng-container>

      <div
        class="gutter"
        [ngStyle]="{
          width: cardSize / 2 + 'px'
        }"
      ></div>
    </div>

    <div
      class="player-hand"
      id="player-hand"
      cdkDropList
      [cdkDropListConnectedTo]="
        isPlacingMultipleCards ? 'place-multiple-cards-list' : 'position'
      "
      (cdkDropListDropped)="onPlayerHandCardDrop($event)"
      cdkDropListData="player-hand"
      cdkDropListOrientation="horizontal"
      *ngIf="playerGameState.Hand"
      [ngStyle]="{
        height: cardSize + 'px',
        width: 5 * cardSize + 'px',
        margin: 'auto'
      }"
    >
      <app-card
        *ngFor="
          let card of isPlacingMultipleCards
            ? (placeMultipleCardsHand$ | async) ?? []
            : playerGameState.Hand.Cards
        "
        [cardImageFileName]="getCardImageFileName(card)"
        [card]="card"
        [playerCanDrag]="isPlayersTurn"
        [ngStyle]="{
          opacity: isPlayersTurn ? 1 : 0.75
        }"
      ></app-card>
    </div>

    <div
      class="button-toolbar"
      [ngStyle]="{
        padding: '0px ' + cardSize / 2 + 'px'
      }"
    >
      <ng-container *ngIf="isPlacingMultipleCards; else passButton">
        <button
          mat-raised-button
          class="confirm-button"
          color="primary"
          (click)="onConfirmButtonClicked()"
        >
          Confirm
        </button>
        <div class="button-divider"></div>
        <button
          mat-raised-button
          class="cancel-button"
          color="warn"
          (click)="onCancelButtonClicked()"
        >
          Cancel
        </button>
      </ng-container>

      <ng-template #passButton>
        <button
          (click)="onPassButtonClicked()"
          mat-raised-button
          color="primary"
          class="pass-button"
          [disabled]="!isPlayersTurn"
        >
          Pass
        </button>
      </ng-template>
    </div>
  </div>
</div>
