<nav
  class="sidebar bg-gray-600 dark:bg-gray-800 h-full flex flex-col transition w-20 shadow-lg"
>
  @if ((playerGameView$ | async)?.GameCode; as gameCode) {
    <div class="flex flex-col justify-around text-center my-2 px-1">
      <div
        class="text-gray-300 dark:text-gray-400 semibold text-center text-md h-sm-hidden"
      >
        Game<br />Code
      </div>
      <div
        class="text-gray-200 tracking-widest font-bold text-center text-md mt-1"
      >
        {{ gameCode }}
      </div>
    </div>
  }

  <div class="divider mx-2"></div>

  <div
    class="px-1"
    [ngClass]="{
      'lg:hidden': !(isShowingCardStack$ | async)
    }"
  >
    <app-icon-button
      [itemHeight]="64"
      [itemWidth]="64"
      [iconSize]="32"
      [tooltip]="(isShowingCardStack$ | async) ? 'Hide Stack' : 'Show Stack'"
      materialSymbol="playing_cards"
      (selected)="toggleCardStack()"
    ></app-icon-button>
  </div>

  @if (isShowingCardStack$ | async) {
    <card-stack
      class="h-full"
      [cardStack]="cardStack"
      [position]="selectedPosition"
      [cardSize]="(cardSize$ | async) ?? 64"
    ></card-stack>
  } @else {
    <div class="px-1">
      <app-icon-button
        data-testid="pass-move-button"
        [disabled]="!!(waitingForServer$ | async)"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Pass move"
        materialSymbol="waving_hand"
        (selected)="attemptToOpenPassMoveModal()"
      ></app-icon-button>
      <app-icon-button
        [disabled]="!!(waitingForServer$ | async)"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Offer draw"
        materialSymbol="handshake"
        (selected)="attemptToOpenOfferDrawModel()"
      ></app-icon-button>
      <app-icon-button
        [disabled]="!!(waitingForServer$ | async)"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Resign"
        materialSymbol="flag"
        (selected)="openResignModal()"
      ></app-icon-button>
      <app-icon-button
        class="block dark:hidden"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Dark Mode"
        materialSymbol="dark_mode"
        (selected)="toggleDarkMode()"
      ></app-icon-button>
      <app-icon-button
        class="hidden dark:block"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Light Mode"
        materialSymbol="light_mode"
        (selected)="toggleDarkMode()"
      ></app-icon-button>
      <!-- TODO: Build report bug -->
      <!-- <app-icon-button
        [disabled]="true"
        [itemHeight]="64"
        [itemWidth]="64"
        [iconSize]="32"
        tooltip="Report Bug"
        materialSymbol="bug_report"
        (selected)="reportBug()"
      ></app-icon-button> -->
    </div>

    @if (numCardsInOpponentDeck !== null && numCardsInPlayerDeck !== null) {
      <div class="divider mx-2"></div>
    }
    @if (numCardsInOpponentDeck !== null && numCardsInPlayerDeck !== null) {
      <div class="game-stats">
        <div
          data-testid="opponent-time"
          class="remaining-time"
          [ngClass]="{
            'is-not-counting-down': isPlayersTurn
          }"
        >
          <span>
            {{ opponentsRemainingSecondsString }}
          </span>
        </div>
        <div class="deck-counts">
          <div data-testid="opponent-deck-count" class="deck-count">
            {{ numCardsInOpponentDeck }}
          </div>
          <div class="flex justify-around">
            <game-face-down-card></game-face-down-card>
          </div>
          <div class="hidden md:flex h-sm-hidden flex justify-around">
            <game-face-down-card></game-face-down-card>
          </div>
          <div data-testid="player-deck-count" class="deck-count">
            {{ numCardsInPlayerDeck }}
          </div>
        </div>
        <div
          data-testid="player-time"
          class="remaining-time"
          [ngClass]="{
            'low-time-container': playerHasLowTime,
            'is-not-counting-down': !isPlayersTurn
          }"
        >
          <span>{{ playersRemainingSecondsString }}</span>
        </div>
      </div>
    }
  }
</nav>
