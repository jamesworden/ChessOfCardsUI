<div *ngIf="!gameIsRunning">
  <span *ngIf="gameOverMessage">❌ Game Over: {{ gameOverMessage }} ❌</span>
</div>

<div class="game-container">
  <div
    class="game"
    *ngIf="playerGameState$ | async as playerGameState"
    cdkDropListGroup
  >
    <div class="opponent-hand">
      <app-face-down-card
        *ngFor="
          let _ of [].constructor(playerGameState.NumCardsInOpponentsHand)
        "
      ></app-face-down-card>
    </div>

    <div class="board" *ngIf="playerGameState.IsHost">
      <div class="gutter"></div>

      <div
        class="lane"
        *ngFor="let lane of playerGameState.Lanes; let laneIndex = index"
      >
        <ng-container *ngFor="let row of lane.Rows; let rowIndex = index">
          <app-position
            [laneIndex]="laneIndex"
            [rowIndex]="6 - rowIndex"
            (makeMove)="makeMove($event)"
          >
            <app-card
              *ngIf="lane.Rows[6 - rowIndex].length > 0"
              [suit]="getTopCard(lane.Rows[6 - rowIndex]).Suit"
              [kind]="getTopCard(lane.Rows[6 - rowIndex]).Suit"
              [cardImageFileName]="
                getCardImageFileName(getTopCard(lane.Rows[6 - rowIndex]))
              "
            ></app-card>
          </app-position>
        </ng-container>
      </div>

      <div class="gutter">
        <app-deck
          [totalNumCards]="playerGameState.NumCardsInOpponentsDeck"
          [onRightSide]="true"
        ></app-deck>

        <app-deck
          [totalNumCards]="playerGameState.NumCardsInPlayersDeck"
          [onRightSide]="true"
        ></app-deck>
      </div>
    </div>

    <div class="board" *ngIf="!playerGameState.IsHost">
      <div class="gutter">
        <app-deck
          [totalNumCards]="playerGameState.NumCardsInOpponentsDeck"
          [onRightSide]="false"
        ></app-deck>

        <app-deck
          [totalNumCards]="playerGameState.NumCardsInPlayersDeck"
          [onRightSide]="false"
        ></app-deck>
      </div>

      <div
        class="lane"
        *ngFor="let lane of playerGameState.Lanes; let laneIndex = index"
      >
        <ng-container *ngFor="let row of lane.Rows; let rowIndex = index">
          <app-position
            [laneIndex]="laneIndex"
            [rowIndex]="rowIndex"
            (makeMove)="makeMove($event)"
          >
            <app-card
              *ngIf="row.length > 0"
              [suit]="getTopCard(row).Suit"
              [kind]="getTopCard(row).Suit"
              [cardImageFileName]="getCardImageFileName(getTopCard(row))"
            ></app-card>
          </app-position>
        </ng-container>
      </div>

      <div class="gutter"></div>
    </div>

    <div
      class="player-hand"
      id="player-hand"
      cdkDropList
      cdkDropListConnectedTo="position"
      (cdkDropListDropped)="rearrangeHand($event)"
      cdkDropListData="player-hand"
      cdkDropListOrientation="horizontal"
    >
      <app-card
        *ngFor="let card of playerGameState.Hand.Cards"
        [suit]="card.Suit"
        [kind]="card.Kind"
        [cardImageFileName]="getCardImageFileName(card)"
        [playerCanDrag]="true"
      ></app-card>
    </div>

    <ng-template #decks>
      <app-deck
        [totalNumCards]="playerGameState.NumCardsInOpponentsDeck"
        [onRightSide]="playerGameState.IsHost"
      ></app-deck>

      <app-deck
        [totalNumCards]="playerGameState.NumCardsInPlayersDeck"
        [onRightSide]="playerGameState.IsHost"
      ></app-deck>
    </ng-template>
  </div>
</div>
